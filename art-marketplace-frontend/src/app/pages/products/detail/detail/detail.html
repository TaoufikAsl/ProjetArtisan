<!-- Avis -->
<mat-card class="reviews" *ngIf="!loading && product">
  <h3>Avis</h3>

  <ng-container *ngIf="reviews$ | async as reviews">
    <p *ngIf="reviews.length === 0">Aucun avis pour l’instant.</p>
    <ul *ngIf="reviews.length > 0">
      <li *ngFor="let r of reviews">
        ★ {{ r.rating }} — {{ r.comment || '—' }}
        <small> ({{ r.createdAt | date:'short' }})</small>
      </li>
    </ul>
  </ng-container>

  <mat-card-actions>
  <button mat-button (click)="back()">Retour</button>

  <!-- Afficher le bouton uniquement pour le rôle Client -->
  <button
    mat-raised-button
    color="primary"
    *ngIf="canOrder()"
    (click)="order()">
    Commander
  </button>

  <button mat-stroked-button color="primary" (click)="addToCart()">Ajouter au panier</button> <!-- Bouton pour ajouter au panier -->
  


</mat-card-actions>


  <!-- Formulaire client -->
  <div *ngIf="canReview()" class="review-form">
    <h4>Laisser un avis</h4>
    <form (ngSubmit)="submitReview()" [formGroup]="reviewForm" novalidate>
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Note</mat-label>
        <mat-select formControlName="rating" required>
          <mat-option *ngFor="let n of [5,4,3,2,1]" [value]="n">{{ n }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Commentaire (optionnel)</mat-label>
        <textarea matInput rows="3" formControlName="comment"></textarea>
      </mat-form-field>

      <button mat-raised-button color="primary" class="w-100" type="submit" [disabled]="reviewForm.invalid || adding">
        {{ adding ? 'Envoi…' : 'Publier l’avis' }}
      </button>
    </form>
  </div>
</mat-card>

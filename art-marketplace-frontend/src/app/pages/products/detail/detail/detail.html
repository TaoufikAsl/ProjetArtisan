<mat-card *ngIf="!loading && product; else loadingTpl" class="product-detail">
  <div class="header">
    <h2 class="title">
      {{ product.title }}
      <button
        *ngIf="isClient"
        mat-icon-button
        type="button"
        (click)="$event.stopPropagation(); toggleFavorite()"
        [attr.aria-pressed]="isFavorite"
        [color]="isFavorite ? 'warn' : undefined"
        class="ml-2"
        [title]="isFavorite ? 'Retirer des favoris' : 'Ajouter aux favoris'">
        <mat-icon>{{ isFavorite ? 'favorite' : 'favorite_border' }}</mat-icon>
      </button>
    </h2>

    <div class="price">{{ product.price | currency:'EUR':'symbol-narrow' }}</div>
  </div>

  <!-- image avec gestion d'erreur -->
  <div class="image-wrap" *ngIf="product.imageUrl">
    <img 
      [src]="product.imageUrl" 
      [alt]="product.title"
      (error)="onImageError($event)"
      loading="lazy" />
  </div>

  <p class="desc">{{ product.description || 'â€”' }}</p>

  <mat-card-actions>
    <button mat-button (click)="back()">
      <mat-icon>arrow_back</mat-icon>
      Retour
    </button>

   
    <button mat-stroked-button color="primary" (click)="addToCart()">
      <mat-icon>add_shopping_cart</mat-icon>
      Ajouter au panier
    </button>
  </mat-card-actions>
</mat-card>

<!-- Le reste du template reste identique... -->
<ng-template #loadingTpl>
  <div class="center">
    <mat-progress-spinner diameter="40"></mat-progress-spinner>
    <p>Chargement du produit...</p>
  </div>
</ng-template>
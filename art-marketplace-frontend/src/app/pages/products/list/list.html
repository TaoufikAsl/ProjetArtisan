<div class="wrapper">
  <h2>Catalogue</h2>

  <!-- Filtres -->
  <mat-card class="filters">
    <form [formGroup]="form" class="row">
      <mat-form-field appearance="outline" class="q">
        <mat-label>Rechercher</mat-label>
        <input matInput formControlName="q" placeholder="Titre ou description" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="num">
        <mat-label>Prix min</mat-label>
        <input matInput type="number" formControlName="minPrice" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="num">
        <mat-label>Prix max</mat-label>
        <input matInput type="number" formControlName="maxPrice" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="sort">
        <mat-label>Trier par</mat-label>
        <mat-select formControlName="sort">
          <mat-option value="recent">Récents</mat-option>
          <mat-option value="priceAsc">Prix ↑</mat-option>
          <mat-option value="priceDesc">Prix ↓</mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </mat-card>

  <!-- Loading -->
  <div class="center" *ngIf="loading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Erreur -->
  <p class="error" *ngIf="!loading && error">{{ error }}</p>

  <!-- Liste produits -->
  <ng-container *ngIf="!loading && !error">
    <div class="grid" *ngIf="products.length; else noneTpl">
      <mat-card class="product" *ngFor="let p of products; trackBy: trackById">
        <img mat-card-image [src]="p.imageUrl || 'assets/placeholder.png'" [alt]="p.title">
        <mat-card-title>{{ p.title }}</mat-card-title>
        <mat-card-content>
          <p class="price">{{ p.price | currency:'EUR':'symbol-narrow' }}</p>
          <p class="desc">{{ p.description || '—' }}</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-stroked-button (click)="open(p)">Voir</button>
          <button mat-raised-button color="primary" (click)="addToCart(p)">Ajouter au panier</button>
        </mat-card-actions>
      </mat-card>
    </div>

    <ng-template #noneTpl>
      <p style="padding:12px">Aucun produit ne correspond à votre recherche.</p>
    </ng-template>
  </ng-container>
</div>
